<extend name="public:tpl" />
<block name="css">
    <!--layer-->
    <link href="__CSS__/layui.css" rel="stylesheet">
</block>
        <!-- header section end-->
<block name="main">
    <div class="page-heading">
        <h3>
            订单管理
        </h3>
        <ul class="breadcrumb">
            <li>
                <a href="#">订单管理</a>
            </li>
            <li class="active"> 充值订单 </li>
        </ul>
    </div>
    <!-- page heading end-->

    <div class="wrapper">
        <div class="row">
            <div class="col-sm-12">
                <section class="panel">
                    <header class="panel-heading">
                        充值订单
                    </header>
                    <div class="panel-body">
<input type="hidden" value="{$count}" name="count">
                        <!--搜索开始-->
                        <form class="form-inline" method="get">
                            <div class="form-group">
                                <label>订单号</label>
                                <input type="text" class="form-control" name="order_number" value="" placeholder="请输入订单号">
                            </div>
                            <button type="submit" class="btn btn-primary" id="sea">搜索</button>
                        </form>




                        <!--搜索结束-->
                        <hr/>
                        <div class="adv-table text-center">
                            <table  class="display table table-bordered table-striped" id="dynamic-table">
                                <thead>
                                <tr>
                                    <th class="text-center">编号</th>
                                    <th class="text-center">订单号</th>
                                    <th class="text-center">充值用户</th>
                                    <th class="text-center">充值时间</th>
                                    <th class="text-center">充值金额</th>
                                    <th class="text-center">状态</th>
                                    <th class="text-center">操作</th>
                                </tr>
                                </thead>
                                <tbody id="body">
                                <if condition="empty($order)">
                                    <tr>
                                        <td colspan="9">暂无数据</td>
                                    </tr>
                                </if>
                                <volist name="order" id="o">
                                <tr class="gradeX">
                                    <td style="vertical-align: middle">{$o.id}</td>
                                    <td style="vertical-align: middle">{$o.order_number}</td>
                                    <td style="vertical-align: middle">{$o.username}</td>
                                    <td style="vertical-align: middle">{:date('Y-m-d',$o['create_time'])}</td>
                                    <td style="vertical-align: middle">{$o.money}</td>
                                    <td style="vertical-align: middle">
                                        {$o.is_pass}
                                    </td>
                                    <td style="vertical-align: middle"><input type="button" data-id="{$o['id']}" class="btn btn-xs btn-info detail" value="查看"  ></td>
                                </tr>
                                </volist>
                                </tbody>
                            </table>
                            <div id="demo6"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">提示：Notice!</h4>
                </div>
                <div class="modal-body">
                    你确认要删除吗？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <a href="" id="deleteTrue" class="btn btn-primary">确定</a>
                </div>
            </div>
        </div>
    </div>
    <script src="__PUBLIC__/js/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script src="__PUBLIC__/layer/layer.js" type="text/javascript"></script>
    <script>

    </script>
</block>
<block name="js">
    <!--layer.js-->
    <script src="__JS__/layer/layui.js"></script>
    <script src="__JS__/layer/laypage.js"></script>
    <script>
        $(function(){
            layui.use(['laypage', 'layer'], function(){
                var laypage = layui.laypage,layer = layui.layer;
                laypage({
                    cont: 'demo6'
                    ,pages: $('input[name = count]').val()
                    ,skip: true
                    ,jump: function(obj, first){
                        if(!first){
                            $.ajax({
                                'type':'post',
                                'dataType':'json',
                                'url':"{:U('admin/Order/recharge')}",
                                'data':{
                                    'pgNum':obj.curr,
                                    'pgSize':15,
                                    'type':$('select[name = type]').val()
                                },
                                success:function(result){
                                    $('#body').html('');
                                    if(result.status == 1 && result.data != ''){
                                        $.each(result.data,function(k,v){
                                            $('#body').append(
                                                    '<tr align="center">'+
                                                    '<td>'+ v.id+'</td>'+
                                                    '<td>'+ v.order_number+'</td>'+
                                                    '<td>'+ v.username+'</td>'+
                                                    '<td>'+ v.create_time+'</td>'+
                                                    '<td>'+ v.money+'</td>'+
                                                    '<td>'+ v.is_pass +'</td>'+
                                                    '<td>'+'<input type="button" class="btn btn-xs btn-info detail" value="查看" data-id="'+ v.id+'">'+'</td>'+
                                                    "</tr>"
                                            );
                                        });
                                    }
                                }
                            });
                        }
                    }
                });
            });

        });


        $('body').on('click','.detail',function(){
            var id = $(this).attr('data-id');
            layer.open({
                type: 2,
                title: '作品详情',
                shadeClose: true,
                shade: 0.8,
                area: ['70%', '100%'],
                content: "{:U('admin/Order/detail')}"+'?id='+id,
                end: function () {
                    location.reload();
                }
            });
        });
        $('#sea').click(function(){
            $.ajax({
                'type':'post',
                'dataType':'json',
                'url':"{:U('admin/Order/recharge')}",
                'data':{
                    'order_number':$('input[name = order_number]').val(),
                },
                success:function(result){
                    $('#body').html('');
                    $.each(result.data,function(k,v){
                        $('#body').append(
                                '<tr align="center">'+
                                '<td>'+ v.id+'</td>'+
                                '<td>'+ v.order_number+'</td>'+
                                '<td>'+ v.username+'</td>'+
                                '<td>'+ v.create_time+'</td>'+
                                '<td>'+ v.money+'</td>'+
                                '<td>'+ v.is_pass +'</td>'+
                                '<td>'+'<input type="button" class="btn btn-xs btn-info detail" value="查看" data-id="'+ v.id+'">'+'</td>'+
                                "</tr>"
                        );
                    });

                }
            });
        });
    </script>
</block>
